var T=Object.defineProperty,D=Object.defineProperties;var L=Object.getOwnPropertyDescriptors;var h=Object.getOwnPropertySymbols;var P=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable;var I=(i,t,e)=>t in i?T(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,u=(i,t)=>{for(var e in t||(t={}))P.call(t,e)&&I(i,e,t[e]);if(h)for(var e of h(t))K.call(t,e)&&I(i,e,t[e]);return i},w=(i,t)=>D(i,L(t));var d=(i,t,e)=>new Promise((a,o)=>{var n=c=>{try{s(e.next(c))}catch(m){o(m)}},r=c=>{try{s(e.throw(c))}catch(m){o(m)}},s=c=>c.done?a(c.value):Promise.resolve(c.value).then(n,r);s((e=e.apply(i,t)).next())});import{nanoid as v}from"nanoid";var f={video:{width:{ideal:960},height:{ideal:540},frameRate:30,videoAspectRatio:1.7777777778},audio:{echoCancellation:!0,noiseSuppression:!0},display:{audio:!0,video:{height:1080}}},A=(i,t)=>{if(i.label)return i.label;let e=o=>o.charAt(0).toUpperCase()+o.slice(1),a=i.kind.replace(/(audio|video)(\w+)/,"$1 $2").split(" ");return`${e(a[0])} ${e(a[1])} ${t}`},E=i=>{var n;let[t,e]=i!=null&&i.label?i.label.split(":"):["Screen","Capture"],a=t.startsWith("web")?"Tab":`${t[0].toLocaleUpperCase()}${t.substr(1)}`,o=t.startsWith("web")?(n=e==null?void 0:e.replace(/\//g,""))==null?void 0:n.substr(-5):e;return`${a}${o?` ${o}`:""}`},F=i=>({audio:!0,video:{width:1920,height:1080,frameRate:40,displaySurface:i}}),y=i=>d(void 0,null,function*(){return yield new Promise(t=>{let e=document.createElement("video");e.muted=!0,e.srcObject=i,e.onloadedmetadata=()=>{let a=e.videoWidth/e.videoHeight;t({width:e.videoWidth,height:e.videoHeight,ratio:a}),e.remove()}})}),p=(i,t)=>d(void 0,null,function*(){return new Promise(e=>{let a=document.createElement("input");a.accept=i,a.multiple=!1,a.hidden=!0,a.type="file",a.addEventListener("change",o=>d(void 0,null,function*(){e(yield t(o))})),document.body.appendChild(a),a.click()})}),C=i=>d(void 0,null,function*(){return yield new Promise(t=>{var o;let[e]=(o=i.target)==null?void 0:o.files,a=new FileReader;a.onloadend=n=>{var s;let r=new Image;r.src=(s=n.target)==null?void 0:s.result,r.onload=()=>{t({id:v(),width:r.width,height:r.height,ratio:r.width/r.height,name:e.name,sourceKind:"imagefile",sourceType:"visual",source:r})}},a.readAsDataURL(e)})}),x=i=>d(void 0,null,function*(){return yield new Promise(t=>{var n;let[e]=(n=i.target)==null?void 0:n.files,a=document.createElement("video"),o=new FileReader;o.onload=r=>{var s;a.src=(s=r.target)==null?void 0:s.result,a.onloadedmetadata=()=>{t({id:v(),width:a.videoWidth,height:a.videoHeight,ratio:a.videoWidth/a.videoHeight,name:e.name,sourceKind:"videofile",sourceType:"visual",source:a})},a.load()},o.readAsDataURL(e)})}),B=i=>d(void 0,null,function*(){return yield new Promise(t=>{var n;let[e]=(n=i.target)==null?void 0:n.files,a=document.createElement("audio"),o=new FileReader;o.onload=r=>{var s;a.src=(s=r.target)==null?void 0:s.result,a.onloadedmetadata=()=>{t({id:v(),name:e.name,sourceKind:"audiofile",sourceType:"sound",source:a})},a.load()},o.readAsDataURL(e)})}),S=(i,t)=>d(void 0,null,function*(){let e=yield b(F(i)),{width:a,height:o,ratio:n}=yield y(e),[r]=e.getAudioTracks(),[s]=e.getVideoTracks(),c=E(s);return{id:e.id,name:c,sourceKind:t,sourceType:"visual",width:a,height:o,ratio:n,soundTrack:!!r,source:e}}),V=(i,t,e)=>d(void 0,null,function*(){let o=yield M(i==="audioinput"?"audio":"video",{deviceId:{exact:t}}),n={id:o.id,name:e,source:o,sourceKind:i,sourceType:i==="audioinput"?"sound":"visual"};if(i==="videoinput"){let{width:r,height:s,ratio:c}=yield y(o);return w(u({},n),{width:r,height:s,ratio:c})}return n}),g=i=>d(void 0,null,function*(){let t=yield navigator.mediaDevices.enumerateDevices();switch(i){case"audioinput":case"videoinput":return t.filter(e=>e.kind===i);case"input":case"output":return t.filter(e=>e.kind.endsWith(i));default:return t}}),M=(e,...a)=>d(void 0,[e,...a],function*(i,t={}){return yield navigator.mediaDevices.getUserMedia({[i]:u(u({},f[i]),t)})}),b=(...t)=>d(void 0,[...t],function*(i={}){let e=u(u({},f.display),i);return yield navigator.mediaDevices.getDisplayMedia(e)}),l=i=>d(void 0,null,function*(){switch(i){case"imagefile":return p("image/*",C);case"videofile":return p("video/*",x);case"audiofile":return p("audio/*",B)}}),k=()=>d(void 0,null,function*(){let i=0,t=()=>i+=1,e=[{id:t(),label:"Image",sourceKind:"imagefile",getSource:()=>l("imagefile")},{id:t(),label:"Video",sourceKind:"videofile",getSource:()=>l("videofile")},{id:t(),label:"Audio",sourceKind:"audiofile",getSource:()=>l("audiofile")},{id:t(),label:"Display Capture",sourceKind:"displaycapture",getSource:()=>S("monitor","displaycapture")},{id:t(),label:"Window Capture",sourceKind:"windowcapture",getSource:()=>S("window","windowcapture")},{id:t(),label:"Browser Capture",sourceKind:"browsercapture",getSource:()=>S("browser","browsercapture")}],a=(o,n)=>{for(let r of o)if(r.deviceId!=="default"){let s=t(),c=A(r,s);e.push({id:s,label:c,sourceKind:n,getSource:()=>d(void 0,null,function*(){return yield V(n,r.deviceId,c)})})}};return a(yield g("audioinput"),"audioinput"),a(yield g("videoinput"),"videoinput"),e}),$={devices:g,loadFile:l,getMediaTrack:M,getDisplay:b,getMediaList:k};export{$ as default};
//# sourceMappingURL=index.mjs.map