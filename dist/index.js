"use strict";var l=Object.defineProperty,L=Object.defineProperties,P=Object.getOwnPropertyDescriptor,K=Object.getOwnPropertyDescriptors,A=Object.getOwnPropertyNames,I=Object.getOwnPropertySymbols;var f=Object.prototype.hasOwnProperty,E=Object.prototype.propertyIsEnumerable;var w=(i,t,e)=>t in i?l(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,u=(i,t)=>{for(var e in t||(t={}))f.call(t,e)&&w(i,e,t[e]);if(I)for(var e of I(t))E.call(t,e)&&w(i,e,t[e]);return i},y=(i,t)=>L(i,K(t));var F=(i,t)=>{for(var e in t)l(i,e,{get:t[e],enumerable:!0})},C=(i,t,e,a)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of A(t))!f.call(i,o)&&o!==e&&l(i,o,{get:()=>t[o],enumerable:!(a=P(t,o))||a.enumerable});return i};var x=i=>C(l({},"__esModule",{value:!0}),i);var d=(i,t,e)=>new Promise((a,o)=>{var n=c=>{try{s(e.next(c))}catch(S){o(S)}},r=c=>{try{s(e.throw(c))}catch(S){o(S)}},s=c=>c.done?a(c.value):Promise.resolve(c.value).then(n,r);s((e=e.apply(i,t)).next())});var N={};F(N,{default:()=>O});module.exports=x(N);var p=require("nanoid");var M={video:{width:{ideal:960},height:{ideal:540},frameRate:30,videoAspectRatio:1.7777777778},audio:{echoCancellation:!0,noiseSuppression:!0},display:{audio:!0,video:{height:1080}}},B=(i,t)=>{if(i.label)return i.label;let e=o=>o.charAt(0).toUpperCase()+o.slice(1),a=i.kind.replace(/(audio|video)(\w+)/,"$1 $2").split(" ");return`${e(a[0])} ${e(a[1])} ${t}`},V=i=>{var n;let[t,e]=i!=null&&i.label?i.label.split(":"):["Screen","Capture"],a=t.startsWith("web")?"Tab":`${t[0].toLocaleUpperCase()}${t.substr(1)}`,o=t.startsWith("web")?(n=e==null?void 0:e.replace(/\//g,""))==null?void 0:n.substr(-5):e;return`${a}${o?` ${o}`:""}`},k=i=>({audio:!0,video:{width:1920,height:1080,frameRate:40,displaySurface:i}}),b=i=>d(void 0,null,function*(){return yield new Promise(t=>{let e=document.createElement("video");e.muted=!0,e.srcObject=i,e.onloadedmetadata=()=>{let a=e.videoWidth/e.videoHeight;t({width:e.videoWidth,height:e.videoHeight,ratio:a}),e.remove()}})}),g=(i,t)=>d(void 0,null,function*(){return new Promise(e=>{let a=document.createElement("input");a.accept=i,a.multiple=!1,a.hidden=!0,a.type="file",a.addEventListener("change",o=>d(void 0,null,function*(){e(yield t(o))})),document.body.appendChild(a),a.click()})}),H=i=>d(void 0,null,function*(){return yield new Promise(t=>{var o;let[e]=(o=i.target)==null?void 0:o.files,a=new FileReader;a.onloadend=n=>{var s;let r=new Image;r.src=(s=n.target)==null?void 0:s.result,r.onload=()=>{t({id:(0,p.nanoid)(),width:r.width,height:r.height,ratio:r.width/r.height,name:e.name,sourceKind:"imagefile",sourceType:"visual",source:r})}},a.readAsDataURL(e)})}),R=i=>d(void 0,null,function*(){return yield new Promise(t=>{var n;let[e]=(n=i.target)==null?void 0:n.files,a=document.createElement("video"),o=new FileReader;o.onload=r=>{var s;a.src=(s=r.target)==null?void 0:s.result,a.onloadedmetadata=()=>{t({id:(0,p.nanoid)(),width:a.videoWidth,height:a.videoHeight,ratio:a.videoWidth/a.videoHeight,name:e.name,sourceKind:"videofile",sourceType:"visual",source:a})},a.load()},o.readAsDataURL(e)})}),$=i=>d(void 0,null,function*(){return yield new Promise(t=>{var n;let[e]=(n=i.target)==null?void 0:n.files,a=document.createElement("audio"),o=new FileReader;o.onload=r=>{var s;a.src=(s=r.target)==null?void 0:s.result,a.onloadedmetadata=()=>{t({id:(0,p.nanoid)(),name:e.name,sourceKind:"audiofile",sourceType:"sound",source:a})},a.load()},o.readAsDataURL(e)})}),v=(i,t)=>d(void 0,null,function*(){let e=yield D(k(i)),{width:a,height:o,ratio:n}=yield b(e),[r]=e.getAudioTracks(),[s]=e.getVideoTracks(),c=V(s);return{id:e.id,name:c,sourceKind:t,sourceType:"visual",width:a,height:o,ratio:n,soundTrack:!!r,source:e}}),W=(i,t,e)=>d(void 0,null,function*(){let o=yield T(i==="audioinput"?"audio":"video",{deviceId:{exact:t}}),n={id:o.id,name:e,source:o,sourceKind:i,sourceType:i==="audioinput"?"sound":"visual"};if(i==="videoinput"){let{width:r,height:s,ratio:c}=yield b(o);return y(u({},n),{width:r,height:s,ratio:c})}return n}),h=i=>d(void 0,null,function*(){let t=yield navigator.mediaDevices.enumerateDevices();switch(i){case"audioinput":case"videoinput":return t.filter(e=>e.kind===i);case"input":case"output":return t.filter(e=>e.kind.endsWith(i));default:return t}}),T=(e,...a)=>d(void 0,[e,...a],function*(i,t={}){return yield navigator.mediaDevices.getUserMedia({[i]:u(u({},M[i]),t)})}),D=(...t)=>d(void 0,[...t],function*(i={}){let e=u(u({},M.display),i);return yield navigator.mediaDevices.getDisplayMedia(e)}),m=i=>d(void 0,null,function*(){switch(i){case"imagefile":return g("image/*",H);case"videofile":return g("video/*",R);case"audiofile":return g("audio/*",$)}}),U=()=>d(void 0,null,function*(){let i=0,t=()=>i+=1,e=[{id:t(),label:"Image",sourceKind:"imagefile",getSource:()=>m("imagefile")},{id:t(),label:"Video",sourceKind:"videofile",getSource:()=>m("videofile")},{id:t(),label:"Audio",sourceKind:"audiofile",getSource:()=>m("audiofile")},{id:t(),label:"Display Capture",sourceKind:"displaycapture",getSource:()=>v("monitor","displaycapture")},{id:t(),label:"Window Capture",sourceKind:"windowcapture",getSource:()=>v("window","windowcapture")},{id:t(),label:"Browser Capture",sourceKind:"browsercapture",getSource:()=>v("browser","browsercapture")}],a=(o,n)=>{for(let r of o)if(r.deviceId!=="default"){let s=t(),c=B(r,s);e.push({id:s,label:c,sourceKind:n,getSource:()=>d(void 0,null,function*(){return yield W(n,r.deviceId,c)})})}};return a(yield h("audioinput"),"audioinput"),a(yield h("videoinput"),"videoinput"),e}),O={devices:h,loadFile:m,getMediaTrack:T,getDisplay:D,getMediaList:U};
//# sourceMappingURL=index.js.map